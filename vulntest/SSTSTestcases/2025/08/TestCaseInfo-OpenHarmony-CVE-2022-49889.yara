/*
* Copyright (c) 2025 Beijing University of Posts and Telecommunications.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/


import "console"
rule CVE_2022_49889{
meta:    
    data="2025-10-25"
    openharmony_sa=""
    cve="CVE_2022_49889"
    affected_files="/dev/block/platform/fe310000.sdhci/by-name/boot_linux"

strings:
    $fix = {
            29 F5 15 94  // BL find_next_bit [修复版特征1]
            56 4D 01 90  // ADRP X22, #nr_cpu_ids@PAGE
            C8 1A 44 B9  // LDR W8, [X22,#nr_cpu_ids@PAGEOFF]
            F5 03 00 AA  // MOV X21, X0
            1F 01 15 6B  // CMP W8, W21
            49 01 00 54  // B.LS loc_FFFFFFC010DBB84
            E0 03 13 AA  // MOV X0, X19
            E1 03 15 2A  // MOV W1, W21
            E8 FF FF 97  // BL ring_buffer_wake_waiters
            A8 06 00 11  // ADD W8, W21, #1
            E0 03 14 AA  // MOV X0, X20
            02 7D 40 93  // SXTW X2, W8
            01 01 80 52  // MOV W1, #8
            1C F5 15 94  // BL find_next_bit [修复版特征2]
    }

condition:
    $fix and console.log("CVE_2022_49889 testcase pass")
}
