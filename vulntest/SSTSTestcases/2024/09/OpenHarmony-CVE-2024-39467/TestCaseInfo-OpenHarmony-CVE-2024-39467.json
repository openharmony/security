/*
Copyright (c) 2024 Beijing University of Posts and Telecommunications.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
{
    "month": "2024-09",
    "release_time": "2024-07-12 ",
    "vulnerabilities": [
        {
            "month": "2024-07",
            "vul_id": {
                "cve": "CVE-2024-39467",
                "openharmony-sa": ""
            },
            "severity": "low",
            "vul_description": {
                "zh": "在 Linux 内核中，已解决以下漏洞： F2FS：修复在 sanity_check_inode（） 中对 i_xattr_nid 进行健全性检查 Syzbot 报告内核错误如下： F2FS-fs （loop0）：使用检查点版本 = 48b305e4 挂载",
                "en": "In the Linux kernel, the following vulnerability has been resolved: f2fs: fix to do sanity check on i_xattr_nid in sanity_check_inode() syzbot reports a kernel bug as below: F2FS-fs (loop0): Mounted with checkpoint version = 48b305e4"
            },
            "vul_impact": {
                "zh": "错误：KASAN：f2fs_test_bit fs/f2fs/f2fs.h：2933 中的 slab-out-of-bounds [内联] 错误：KASAN：current_nat_addr fs/f2fs/node.h：213 中的 slab-out-of-bounds [内联] 错误： KASAN：f2fs_get_node_info+0xece/0x1200 fs/f2fs/node.c：600 任务 syz-executor280/5076 在 addr ffff88807a58c76c 处读取大小为 1 的 CPU：1 PID：5076 Comm：syz-executor280 未受污染 6.9.0-rc5-syzkaller #0 硬件名称：Google Google Compute Engine/Google Compute Engine，BIOS Google 2024 年 3 月 27 日调用跟踪：<TASK> __dump_stack lib/dump_stack.c：88 [内联] dump_stack_lvl+0x241/0x360 lib/dump_stack.c：114 print_address_description mm/kasan/report.c：377 [内联] print_report+0x169/0x550 mm/kasan/report.c：488 kasan_report+0x143/0x180 mm/kasan/report.c：601 f2fs_test_bit fs/f2fs/f2fs.h：2933 [内联] current_nat_addr fs/f2fs/node.h：213 [内联] f2fs_get_node_info+0xece/0x1200 fs/f2fs/node.c：600 f2fs_xattr_fiemap fs/f2fs/data.c：1848 [内联] f2fs_fiemap+0x55d/0x1ee0 fs/f2fs/data.c：1925 ioctl_fiemap fs/ioctl.c：220 [内联] do_vfs_ioctl+0x1c07/0x2e50 fs/ioctl.c：838 __do_sys_ioctl fs/ioctl.c：902 [内联] __se_sys_ioctl+0x81/0x170 fs/ioctl.c：890 do_syscall_x64 arch/x86/entry/common.c：52 [内联] do_syscall_64+0xf5/0x240 arch/x86/entry/common.c：83 entry_SYSCALL_64_after_hwframe+0x77/0x7f 根本原因是我们错过了在 f2fs_iget（） 期间对 i_xattr_nid进行健全性检查， 这样在 fiemap（） 路径中，current_nat_addr（） 会访问带有无效i_xattr_nid偏移量的 nat_bitmap，导致触发 Kasan Bug 报告，修复它。",
                "en": "BUG: KASAN: slab-out-of-bounds in f2fs_test_bit fs/f2fs/f2fs.h:2933 [inline] BUG: KASAN: slab-out-of-bounds in current_nat_addr fs/f2fs/node.h:213 [inline] BUG: KASAN: slab-out-of-bounds in f2fs_get_node_info+0xece/0x1200 fs/f2fs/node.c:600 Read of size 1 at addr ffff88807a58c76c by task syz-executor280/5076 CPU: 1 PID: 5076 Comm: syz-executor280 Not tainted 6.9.0-rc5-syzkaller #0 Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 03/27/2024 Call Trace: <TASK> __dump_stack lib/dump_stack.c:88 [inline] dump_stack_lvl+0x241/0x360 lib/dump_stack.c:114 print_address_description mm/kasan/report.c:377 [inline] print_report+0x169/0x550 mm/kasan/report.c:488 kasan_report+0x143/0x180 mm/kasan/report.c:601 f2fs_test_bit fs/f2fs/f2fs.h:2933 [inline] current_nat_addr fs/f2fs/node.h:213 [inline] f2fs_get_node_info+0xece/0x1200 fs/f2fs/node.c:600 f2fs_xattr_fiemap fs/f2fs/data.c:1848 [inline] f2fs_fiemap+0x55d/0x1ee0 fs/f2fs/data.c:1925 ioctl_fiemap fs/ioctl.c:220 [inline] do_vfs_ioctl+0x1c07/0x2e50 fs/ioctl.c:838 __do_sys_ioctl fs/ioctl.c:902 [inline] __se_sys_ioctl+0x81/0x170 fs/ioctl.c:890 do_syscall_x64 arch/x86/entry/common.c:52 [inline] do_syscall_64+0xf5/0x240 arch/x86/entry/common.c:83 entry_SYSCALL_64_after_hwframe+0x77/0x7f The root cause is we missed to do sanity check on i_xattr_nid during f2fs_iget(), so that in fiemap() path, current_nat_addr() will access nat_bitmap w/ offset from invalid i_xattr_nid, result in triggering kasan bug report, fix it.References"
            },
            "disclosure": {
                "zh": "https://gitee.com/openharmony/security/blob/master/zh/security-disclosure/2024/2024-09.md",
                "en": "https://gitee.com/openharmony/security/blob/master/en/security-disclosure/2024/2024-09.md"
            },
            "patch_info": {
                "4.0.x": {
                    "patch_url": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1497"
                    ],
                    "patch_file": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1497.patch"
                    ],
                    "diff_file": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1497.diff"
                    ]
                },
                "4.1.x": {
                    "patch_url": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1498"
                    ],
                    "patch_file": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1498.patch"
                    ],
                    "diff_file": [
                        "https://gitee.com/openharmony/kernel_linux_5.10/pulls/1498.diff"
                    ]
                }
            },
            "affected_projects": "kernel_linux_5.10",
            "object_type": "kernel_linux",
            "affected_versions": [
                "4.0.0-4.0.2","4.1.0-4.1.2"
            ],
            "affected_device": {
                "mini": {
                    "liteos": {
                        "rics-v": {
                            "scan_strategy": {
                                "ssts": {
                                    "enable": false
                                },
                                "ists": {
                                    "enable": false
                                }
                            }
                        }
                    }
                },
                "small": {
                    "liteos": {
                        "rics-v": {
                            "scan_strategy": {
                                "ssts": {
                                    "enable": false
                                },
                                "ists": {
                                    "enable": false
                                }
                            }
                        }
                    },
                    "linux": {
                        "arm": {
                            "scan_strategy": {
                                "ssts": {
                                    "enable": false
                                },
                                "ists": {
                                    "enable": false
                                }
                            }
                        }
                    }
                },
                "standard": {
                    "linux": {
                        "arm": {
                            "scan_strategy": {
                                "ssts": {
                                    "enable": false
                                },
                                "ists": {
                                    "enable": true,
                                    "yara": {
                                        "affected_files": [
                                            "/dev/block/platform/fe310000.sdhci/by-name/boot_linux"
                                           
                                        ],
                                        "yara_rules": [
                                            "TestCaseRule-OpenHarmony-CVE-2024-39467.yara"
                                        ]
                                    }
                                }
                            }
                        },
                        "arm64": {
                            "scan_strategy": {
                                "ssts": {
                                    "enable": false
                                },
                                "ists": {
                                    "enable": false
                                }
                            }
                        }
                    }
                }
            }
        }
    ]
}